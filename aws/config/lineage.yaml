# Lineage Configuration

This configuration defines how lineage and observability events are emitted throughout the ETL pipeline.

## Configuration Structure

```yaml
# Lineage Configuration
lineage:
  # Namespace for lineage events
  namespace: "company-etl"
  
  # Environment identifier
  environment: "aws-prod"
  
  # Lineage sink configuration
  sink:
    # Primary sink (required)
    primary: "cloudwatch"
    
    # Secondary sinks (optional)
    secondary: ["openlineage"]
  
  # CloudWatch configuration
  cloudwatch:
    namespace: "CompanyETL/Lineage"
    log_group: "/aws/etl/lineage"
    region: "us-east-1"
  
  # OpenLineage configuration (if enabled)
  openlineage:
    enabled: false
    endpoint: "http://openlineage-server:8080"
    namespace: "company-etl"
    api_key: "your-api-key"
  
  # Event retention
  retention:
    cloudwatch_logs_days: 30
    metrics_retention_days: 90
  
  # Sampling configuration
  sampling:
    enabled: true
    sample_rate: 1.0  # 100% sampling in production
  
  # Data quality thresholds
  data_quality:
    warning_threshold: 0.8
    error_threshold: 0.6
    critical_threshold: 0.4
```

## Event Types

### Run Events
- Pipeline execution start/end
- Job status changes
- Error conditions
- Performance metrics

### Lineage Events
- Data flow from source to target
- Transformation details
- Schema changes
- Data quality scores

### Table Events
- Row count changes
- Schema evolution
- Partition updates
- Data freshness

## Integration Points

### EMR Serverless Jobs
Each EMR job emits:
- Start/end events
- Row count metrics
- Processing time
- Error conditions

### Airflow DAGs
Each DAG task emits:
- Task execution status
- Data lineage
- SLA compliance
- Quality metrics

### Data Quality Checks
DQ checks emit:
- Validation results
- Quality scores
- Failure details
- Remediation actions

## Monitoring and Alerting

### CloudWatch Dashboards
- Pipeline execution overview
- Data quality trends
- Performance metrics
- Error rates

### Alerts
- SLA violations
- Data quality degradation
- Pipeline failures
- Performance issues

## Compliance and Audit

### Audit Trail
All lineage events include:
- Timestamp
- User/role information
- Data classification
- Access patterns

### Retention Policies
- Logs: 30 days
- Metrics: 90 days
- Audit events: 7 years

## Best Practices

### Event Design
- Use consistent naming conventions
- Include relevant context
- Minimize payload size
- Use structured data

### Performance
- Batch events when possible
- Use async emission
- Implement circuit breakers
- Monitor emission overhead

### Security
- Encrypt sensitive data
- Use IAM roles
- Implement access controls
- Audit access patterns