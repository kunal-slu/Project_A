# Development Configuration - Phase 2
# Non-secret runtime parameters for AWS deployment

env: dev
region: us-east-1

buckets:
  lake: my-etl-lake-demo-424570854632
  artifacts: my-etl-artifacts-demo-424570854632
  # optional:
  code: my-etl-code-demo-424570854632
  logs: my-etl-logs-demo-424570854632

glue:
  databases:
    bronze: pyspark-etl-project_bronze_dev
    silver: pyspark-etl-project_silver_dev
    gold:   pyspark-etl-project_gold_dev

emr:
  app_id: <PASTE_APP_ID_FROM_TERRAFORM_OUTPUTS>
  execution_role_arn: <PASTE_EXEC_ARN_FROM_TERRAFORM_OUTPUTS>
  spark_defaults:
    spark.sql.extensions: io.delta.sql.DeltaSparkSessionExtension
    spark.sql.catalog.spark_catalog: org.apache.spark.sql.delta.catalog.DeltaCatalog
    spark.delta.logStore.class: org.apache.spark.sql.delta.storage.S3SingleDriverLogStore
    spark.hadoop.fs.s3a.server-side-encryption-algorithm: SSE-KMS
    spark.hadoop.fs.s3a.server-side-encryption.key: <PASTE_KMS_ARN_FROM_TERRAFORM_OUTPUTS>
    spark.sql.adaptive.enabled: "true"
    spark.sql.shuffle.partitions: "200"

paths:
  bronze: s3a://my-etl-lake-demo-424570854632/bronze/
  silver: s3a://my-etl-lake-demo-424570854632/silver/
  gold:   s3a://my-etl-lake-demo-424570854632/gold/
  checkpoints: s3a://my-etl-lake-demo-424570854632/_checkpoints/
  errors:      s3a://my-etl-lake-demo-424570854632/_errors/

dq:
  mode: strict
  critical_checks:
    - primary_keys_not_null
    - referential_integrity
    - non_negative_amounts
    - timestamp_window_valid
    - fx_coverage_all_currencies
  warn_checks:
    - volume_variance_7d
    - schema_evolution_detected
    - late_records_fraction

lineage:
  enabled: true
  emitter: openlineage
  endpoint: https://example-marquez-or-datahub
  namespace: project-a-dev

sla:
  bronze_by_utc: "02:30"
  silver_by_utc: "03:15"
  gold_by_utc:   "04:00"

logging:
  level: INFO

# Source-specific ingestion configuration (P0)
sources:
  snowflake_orders:
    load_type: incremental
    watermark_column: updated_at
    watermark_state_key: snowflake_orders_max_ts
    schema_contract: config/schema_definitions/snowflake_orders_bronze.json
  
  redshift_behavior:
    load_type: incremental
    watermark_column: event_ts
    watermark_state_key: redshift_behavior_max_ts
    schema_contract: config/schema_definitions/redshift_behavior_bronze.json
  
  snowflake_customers:
    load_type: incremental
    watermark_column: last_modified_ts
    watermark_state_key: snowflake_customers_max_ts
    schema_contract: config/schema_definitions/customers_bronze.json
